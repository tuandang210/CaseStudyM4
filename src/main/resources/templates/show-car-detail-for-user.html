<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <style>
        body {
            background: #eee
        }

        .media .media-object { max-width: 120px; }

        .media-date li { padding: 0; }
        .media-date li:first-child:before { content: ''; }
        .media-date li:before {
            content: '.';
            margin-left: -2px;
            margin-right: 2px;
        }


        .btn-circle {
            font-weight: bold;
            font-size: 12px;
            padding: 6px 15px;
            border-radius: 20px;
        }
        .btn-circle span { padding-right: 6px; }

        input[type="file"]{
            z-index: 999;
            line-height: 0;
            font-size: 0;
            position: absolute;
            opacity: 0;
            filter: alpha(opacity = 0);-ms-filter: "alpha(opacity=0)";
            margin: 0;
            padding:0;
            left:0;
        }

    </style>
    <meta charset="UTF-8">
    <title>Cars Dealer Website</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="../../users/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../users/css/main.css">
    <noscript>
        <link rel="stylesheet" href="../../users/css/noscript.css">
    </noscript>
</head>
<body class="is-preload">
<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <header id="header">
        <div class="inner">

            <!-- Logo -->
            <a href="/user-product/list" class="logo">
                <span class="fa fa-star"></span> <span class="title">Car Detail</span>
            </a>

            <!-- Nav -->
            <nav>
                <ul>
                    <li><a href="#menu">Menu</a></li>
                </ul>
            </nav>

        </div>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <h2>Menu</h2>
        <ul>
            <li><a href="/">Home</a></li>

            <li><a href="/user-product/list" class="active">Cars</a></li>

            <li>
                <a href="#" class="dropdown-toggle">About</a>

                <ul>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="team.html">Team</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="testimonials.html">Testimonials</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                    <li><a href="terms.html">Terms</a></li>
                </ul>
            </li>
            <li><a href="contact.html">Contact Us</a></li>
        </ul>
    </nav>

    <!-- Main -->
    <div id="main">
        <div class="inner">
            <h1><b th:text="${product.name}"></b> <span class="pull-right">$ <b style="margin-right: 120px"
                                                                                th:text="${product.sellPrice}"></b></span>
            </h1>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-7">
                        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                            </ol>
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img style="height: 310px; width: 380px; object-fit: cover" class="d-block w-100"
                                         th:src="@{'/../'+${product.imageSet[0].image}}" alt="First slide">
                                </div>
                                <div class="carousel-item">
                                    <img style="height: 310px; width: 380px; object-fit: cover" class="d-block w-100"
                                         th:src="@{'/../'+${product.imageSet[1].image}}" alt="Second slide">
                                </div>
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button"
                               data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button"
                               data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>

                    <div align="center" class="col-lg-5">
                        <h3>Vehicle Description</h3>

                        <p>- Colour coded bumpers<br>- Tinted glass<br>- Immobiliser<br>- Central locking - remote<br>-
                            Passenger airbag<br>- Electric windows<br>- Rear head rests<br>- Radio<br>- CD player</p>
                    </div>
                </div>
            </div>

            <br>


            <form action="#">
                <div class="fields">
                    <div class="field quarter">
                        <label class="m-n">Model</label>

                        <input type="text" readonly="" th:value="${product.name}">
                    </div>
                    <div class="field quarter">
                        <label class="m-n">Type</label>

                        <input type="text" readonly="" th:value="${product.type}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Number of seats</label>

                        <input type="text" readonly="" th:value="${product.seat}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Producer</label>

                        <input type="text" readonly="" th:value="${product.brand.name}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Color</label>

                        <input type="text" readonly="" th:value="${product.color.name}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Mileage</label>

                        <input type="text" readonly="" value="New">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Fuel</label>

                        <input type="text" readonly="" value="Diesel">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Engine size</label>

                        <input type="text" readonly="" value="1800 cc">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Power</label>

                        <input type="text" readonly="" value="125 hp">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Gearbox</label>

                        <input type="text" readonly="" value="Manual">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">First registration</label>

                        <input type="text" readonly="" value="05/2020">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Doors</label>

                        <input type="text" readonly="" value="3/4">
                    </div>


                </div>
            </form>


            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-3">
                        <h3>Contact Details</h3>

                        <ul class="alt">
                            <li><span class="fa fa-user"></span> John Smith</li>
                            <li><span class="fa fa-phone"></span> +1 333 4040 5566</li>
                            <li><span class="fa fa-mobile-phone"></span> +1 333 4040 5566</li>
                            <li><span class="fa fa-envelope-o"></span> <a href="#">john@carsales.com</a></li>

                        </ul>
                    </div>

                    <div class="col-md-9">
                        <h3>Extras </h3>

                        <p>ABS, Leather seats, Power Assisted Steering, Electric heated seats, New HU and AU, Xenon
                            headlights</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- comment-->
    <div>
        <div class="container mt-5">
            <div class="d-flex justify-content-center row">
                <div class="col-md-10">
                    <div class="p-3 bg-white rounded">
                            <div class="tab-pane active" id="add-comment">
                                <form action="#" method="post" class="form-horizontal" id="commentForm" role="form">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">Comment</label>
                                        <div class="col-sm-10">
                                            <textarea style="width: 528px;height: 134px;" class="form-control" name="addComment" id="comment_content"
                                                      rows="5"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-2 col-sm-10">
                                            <button class="btn btn-success btn-circle text-uppercase"
                                                    onclick="send_comment()" type="button" id="submitComment"><span
                                                    class="glyphicon glyphicon-send"></span> Summit comment
                                            </button>
                                            <button class="btn btn-success btn-circle text-uppercase"
                                                    onclick="cancels()" type="button"><span
                                                    class="glyphicon glyphicon-send"></span>Cancel
                                            </button>
                                            <input hidden="hidden" th:value="${product.id}" id="comment_product_in">
                                            <label style="background-color: aliceblue;font-size: 15px;"
                                                   for="comment_rate"
                                                   class="col-form-label">Rate:</label>
                                            <select style="border-radius: 10px;"
                                                    id="comment_rate">
                                                <option value="5" selected>5*</option>
                                                <option value="4">4*</option>
                                                <option value="3">3*</option>
                                                <option value="2">2*</option>
                                                <option value="1">1*</option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        <h6 id="commentList_out">Reviews[8]</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<footer id="footer">
    <div class="inner">
        <section>
            <ul class="icons">
                <li><a href="#" class="icon style2 fa-twitter"><span class="label">Twitter</span></a></li>
                <li><a href="#" class="icon style2 fa-facebook"><span class="label">Facebook</span></a></li>
                <li><a href="#" class="icon style2 fa-instagram"><span class="label">Instagram</span></a></li>
                <li><a href="#" class="icon style2 fa-linkedin"><span class="label">LinkedIn</span></a></li>
            </ul>

            &nbsp;
        </section>

        <ul class="copyright">
            <li>Copyright © 2020 Company Name</li>
            <li>Template by: <a href="https://www.phpjabbers.com/">PHPJabbers.com</a></li>
        </ul>
    </div>
</footer>
</div>


<!-- Scripts -->
<script src="../../users/js/jquery.min.js"></script>
<script src="../../users/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../users/js/jquery.scrolly.min.js"></script>
<script src="../../users/js/jquery.scrollex.min.js"></script>
<script src="../../users/js/main.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>

    function cancels() {
        $('#comment_content').val("");
    }

    function formatDate() {
        let date = new Date()
        let day = date.getDate();
        let month = date.getMonth() + 1;
        let year = date.getFullYear();
        return day + '/' + month + '/' + year;
    }

    function send_comment() {
        let user_id = localStorage.getItem('id');
        let content = $('#comment_content').val();
        let date = formatDate();
        if (content === "") {
            return;
        }
        let rate = $('#comment_rate').val();
        let product_id = $('#comment_product_in').val();
        let newComment = {
            user: {
                id: user_id
            },
            date: date,
            content: content,
            rate: rate,
            product: {
                id: product_id
            },
            likes: 0
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "POST",
            url: `/comments`,
            data: JSON.stringify(newComment),
            success: successHandler
        })
        event.preventDefault();
    }

    function successHandler() {
        let product_id = $('#comment_product_in').val();
        $('#comment_author').val("");
        $('#comment_content').val("");
        $('#comment_rate').val("");
        $('#comment_product').val("");
        $.ajax({
            type: "GET",
            url: `/comments/list/${product_id}`,
            success: function (data) {
                let content = '';
                if (data.length > 5) {
                    for (let i = data.length - 1; i > data.length - 6; i--) {
                        content += getComment(data[i]);
                    }
                } else {
                    for (let i = data.length - 1; i > -1; i--) {
                        content += getComment(data[i]);
                    }
                }
                document.getElementById("commentList_out").innerHTML = content;
            }
        })
        event.preventDefault();
    }

    $(document).ready(function () {
        successHandler();
    })

    function getComment(comment) {
        return `<div className="review mt-4">
            <div className="d-flex flex-row comment-user"><img className="rounded" src="https://i.imgur.com/xxJl1D7.jpg"
                                                               width="40">
                <div className="ml-2">
                    <div className="d-flex flex-row align-items-center"><span className="name font-weight-bold">${comment.user.username}</span><span
                        className="dot"></span></div>
                        <div><span className="date">${comment.date}</span></div>
                    <div className="rating"><i className="fa fa-star"></i><i className="fa fa-star"></i><i
                        className="fa fa-star"></i><i className="fa fa-star"></i></div>
                </div>
            </div>
            <div className="mt-2">
                <p className="comment-text">${comment.content}</p>
            </div>
            <div   style="width: 100%;clear: right">
                                <span>rate : ${comment.rate}</span>
                                <a  class="btn btn-info btn-lg" style="float: right" onclick="likes(${comment.id})" >
                                <span class="glyphicon glyphicon-thumbs-up"></span>
                                like
                                </a>
                                <div style="float: right">
                                   <span style="float: right" id="${comment.id}">${comment.likes}   </span>
                                </div>
            </div>
        </div><br/><br/>`;
    }

    function likes(id) {
        let commentId = id;
        $.ajax({
            type: "GET",
            url: `/comments/${commentId}`,
            success: function (data) {
                document.getElementById(commentId).innerText = data.likes;
            }
        })
        event.preventDefault();
    }
</script>
</body>
</html>