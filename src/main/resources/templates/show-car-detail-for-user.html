<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <style>
        button:hover {
            background-color: chartreuse;
            color: blue;
        }

        textarea:hover {
        }

        select:hover {
            background-color: chartreuse;
            color: blue;
        }
    </style>
    <meta charset="UTF-8">
    <title>Cars Dealer Website</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="../../users/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../users/css/main.css">
    <noscript>
        <link rel="stylesheet" href="../../users/css/noscript.css">
    </noscript>
</head>
<body class="is-preload">
<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <header id="header">
        <div class="inner">

            <!-- Logo -->
            <a href="/user-product/list" class="logo">
                <span class="fa fa-star"></span> <span class="title">The Daimler AG</span>
            </a>

            <!-- Nav -->
            <nav>
                <ul>
                    <li><a href="#menu">Menu</a></li>
                </ul>
            </nav>

        </div>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <h2>Menu</h2>

        <ul>
            <li><a href="/user">Home</a></li>

            <li class="active"><a href="user-product/list">Cars</a></li>

            <li>
                <a href="#" class="dropdown-toggle">About</a>

                <ul>
                    <li><a href="/api/users/about">About Us</a></li>
                    <li><a href="/api/users/team">Team</a></li>
                    <li><a href="/api/users/blog">News</a></li>
                    <li><a href="/api/users/testimonials">Testimonials</a></li>
                    <li><a href="/api/users/faq">FAQ</a></li>
                    <li><a href="/api/users/terms">Terms</a></li>
                </ul>
            </li>

            <li><a href="/logout">Log out</a></li>
        </ul>
    </nav>

    <!-- Main -->
    <div id="main">
        <div class="inner">
            <h1><b th:text="${product.name}"></b> <span class="pull-right">$ <b style="margin-right: 120px"
                                                                                th:text="${product.sellPrice}"></b></span>
            </h1>

            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-7">
                        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                            </ol>
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img style="height: 310px; width: 380px; object-fit: cover" class="d-block w-100"
                                         th:src="@{'/../'+${product.imageSet[0].image}}" alt="First slide">
                                </div>
                                <div class="carousel-item">
                                    <img style="height: 310px; width: 380px; object-fit: cover" class="d-block w-100"
                                         th:src="@{'/../'+${product.imageSet[1].image}}" alt="Second slide">
                                </div>
                            </div>
                            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button"
                               data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button"
                               data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>

                    <div align="center" class="col-lg-5">
                        <h3>Vehicle Description</h3>

                        <p>- Colour coded bumpers<br>- Tinted glass<br>- Immobiliser<br>- Central locking - remote<br>-
                            Passenger airbag<br>- Electric windows<br>- Rear head rests<br>- Radio<br>- CD player</p>
                    </div>
                </div>
            </div>

            <br>

            <form action="#">
                <div class="fields">
                    <div class="field quarter">
                        <label class="m-n">Model</label>

                        <input type="text" readonly="" th:value="${product.name}">
                    </div>
                    <div class="field quarter">
                        <label class="m-n">Type</label>

                        <input type="text" readonly="" th:value="${product.type}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Number of seats</label>

                        <input type="text" readonly="" th:value="${product.seat}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Producer</label>

                        <input type="text" readonly="" th:value="${product.brand.name}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Color</label>

                        <input type="text" readonly="" th:value="${product.color.name}">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Mileage</label>

                        <input type="text" readonly="" value="New">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Fuel</label>

                        <input type="text" readonly="" value="Diesel">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Engine size</label>

                        <input type="text" readonly="" value="1800 cc">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Power</label>

                        <input type="text" readonly="" value="125 hp">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Gearbox</label>

                        <input type="text" readonly="" value="Manual">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">First registration</label>

                        <input type="text" readonly="" value="05/2020">
                    </div>

                    <div class="field quarter">
                        <label class="m-n">Doors</label>

                        <input type="text" readonly="" value="3/4">
                    </div>


                </div>
            </form>

            <!-- comment-->


            <!--            <div class="container-fluid">-->
            <!--                <div class="row">-->
            <!--                    <div class="col-md-3">-->
            <!--                        <h3>Contact Details</h3>-->

            <!--                        <ul class="alt">-->
            <!--                            <li><span class="fa fa-user"></span> John Smith</li>-->
            <!--                            <li><span class="fa fa-phone"></span> +1 333 4040 5566</li>-->
            <!--                            <li><span class="fa fa-mobile-phone"></span> +1 333 4040 5566</li>-->
            <!--                            <li><span class="fa fa-envelope-o"></span> <a href="#">john@carsales.com</a></li>-->

            <!--                        </ul>-->
            <!--                    </div>-->

            <!--                    <div class="col-md-9">-->
            <!--                        <h3>Extras </h3>-->

            <!--                        <p>ABS, Leather seats, Power Assisted Steering, Electric heated seats, New HU and AU, Xenon-->
            <!--                            headlights</p>-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--            </div>-->
        </div>
    </div>


    <!-- comment-->
    <form>
        <div style="margin-right: 200px; margin-left: 200px" align="center">
            <div>
                <div>
                    <div>
                        <div>
                            <p>Comment :</p>
                        </div>
                        <div>
                            <textarea style="border: 1px solid black" id="comment_content"></textarea>
                        </div>

                    </div><br>
                    <div>
                        <button onclick="send_comment()" id="submitComment">Summit</button>
                        <button onclick="cancels()" type="button">Cancel</button>
                        <select id="comment_rate">
                            <option selected value="5">5*</option>
                            <option value="4">4*</option>
                            <option value="3">3*</option>
                            <option value="2">2*</option>
                            <option value="1">1*</option>
                        </select>
                        <div for="comment_rate">Rate :</div>
                    </div>
                </div>
            </div>
        </div>
        <input hidden="hidden" th:value="${product.id}" id="comment_product_in">
        <div style="margin-right: 200px; margin-left: 200px" align="center">
            <h3>All Comments</h3>
        </div>
        <div id="commentList_out">

        </div>
    </form>
    <!-- Footer -->
    <footer id="footer">
        <div class="inner">
            <section>
                <ul class="icons">
                    <li><a href="#" class="icon style2 fa-twitter"><span class="label">Twitter</span></a></li>
                    <li><a href="#" class="icon style2 fa-facebook"><span class="label">Facebook</span></a></li>
                    <li><a href="#" class="icon style2 fa-instagram"><span class="label">Instagram</span></a></li>
                    <li><a href="#" class="icon style2 fa-linkedin"><span class="label">LinkedIn</span></a></li>
                </ul>

                &nbsp;
            </section>

            <ul class="copyright">
                <li>Copyright © 2021 D3T Production</li>
            </ul>
        </div>
    </footer>
</div>

<!-- Scripts -->
<script src="../../users/js/jquery.min.js"></script>
<script src="../../users/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../users/js/jquery.scrolly.min.js"></script>
<script src="../../users/js/jquery.scrollex.min.js"></script>
<script src="../../users/js/main.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>

    function cancels() {
        $('#comment_content').val("");
    }

    function formatDate() {
        let date = new Date()
        let day = date.getDate();
        let month = date.getMonth() + 1;
        let year = date.getFullYear();
        return day + '/' + month + '/' + year;
    }

    function send_comment() {
        let user_id = localStorage.getItem('id');
        let content = $('#comment_content').val();
        let date = formatDate();
        if (content === "") {
            return;
        }
        let rate = $('#comment_rate').val();
        let product_id = $('#comment_product_in').val();
        let newComment = {
            user: {
                id: user_id
            },
            date: date,
            content: content,
            rate: rate,
            product: {
                id: product_id
            },
            likes: 0
        }
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "POST",
            url: `/comments`,
            data: JSON.stringify(newComment),
            success: successHandler
        })
        event.preventDefault();
    }

    function successHandler() {
        let product_id = $('#comment_product_in').val();
        $('#comment_author').val("");
        $('#comment_content').val("");
        $('#comment_rate').val("");
        $('#comment_product').val("");
        $.ajax({
            type: "GET",
            url: `/comments/list/${product_id}`,
            success: function (data) {
                let content = '';
                if (data.length > 5) {
                    for (let i = data.length - 1; i > data.length - 6; i--) {
                        content += getComment(data[i]);
                    }
                } else {
                    for (let i = data.length - 1; i > -1; i--) {
                        content += getComment(data[i]);
                    }
                }
                document.getElementById("commentList_out").innerHTML = content;
            }
        })
        event.preventDefault();
    }

    $(document).ready(function () {
        successHandler();
    })

    function getComment(comment) {
        let a = comment.content;
        let content = setComment(a);
        return `<div>

</div>
<div style="margin-left: 200px; margin-right: 200px">
                <table  border="0">
                    <tr style="text-align: center">
                        <td style="width: 30px;"><span>${comment.user.username}</span></td>
                        <td><span>  Rate : ${comment.rate} stars</span></td>
                        <td><span>${comment.date}</span></td>
                        <td><span id="${comment.id}" >${comment.likes}</span></td>
                        <td><button onclick="likes(${comment.id})" type="button">Likes</button></td>
                    </tr>

                    <tr>
                         <td colspan="5"><p>${content}</p></td>
                    </tr>

                </table>
                </div>
                <div></div>
              <br>`;
    }

    // set comment

    function setComment(comment) {
        let a = '';
        let b = '';
        let c = '';
        let d = '';
        if (comment.length < 71) {
            return `<p>${comment}</p>`;
        } else {
            for (let i = 0; i < 70; i++) {
                a += comment[i]
            }
        }
        if (comment.length > 70) {
            for (let i = 70; i < 140; i++) {
                b += comment[i]
            }
        }
        if (comment.length > 140)
            for (let i = 140; i < 210; i++) {
                c += comment[i]
            }
        if (comment.length > 210) {
            for (let i = 210; i < 280; i++) {
                d += comment[i]
            }
        }
        if (a !== "") {
            if (b !== "") {
                if (c !== "") {
                    if (d !== "") {
                        return `<p>${a}</p><p>${b}</p><p>${c}</p><p>${d}</p>`;
                    } else {
                        return `<p>${a}</p><p>${b}</p><p>${c}</p>`;
                    }
                } else {
                    return `<p>${a}</p><p>${b}</p>`;
                }
            } else {
                return `<p>${a}</p>`
            }
        }
        return ``;
    }

    function likes(id) {
        let commentId = id;
        $.ajax({
            type: "GET",
            url: `/comments/${commentId}`,
            success: function (data) {
                document.getElementById(commentId).innerText = data.likes;
            }
        })
        event.preventDefault();
    }
</script>
</body>
</html>